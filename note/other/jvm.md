
- 线程栈也是堆外内存，当线程数量太多（上万时），也会发生堆外内存溢出。
- 一个线程发生了OOM，并不代表其他线程不可以运行。如果发生oom的线程不是主线程，其他线程暂时也不会请求分配内存的话，其他线程是可以继续执行的。


## 垃圾回收和内存分配

### HotSpot的算法实现

- 枚举根节点：Oopmap数据结构，在类加载完成时，会把对象内什么偏移量上什么数据类型的数据计算出来，在JIT编译过程中，也会记录下栈和寄存器中哪些位置是引用。
- 安全点：HotSpot只在特定的位置记录这些信息，生成OopMap和发生GC。安全点的选定基本上是以程序“是否具有让程序长时间执行的特征”为标准进行选定的
（方法调用、循环跳转、异常跳转等）。GC时需要所有线程都到达安全点。有抢先式中断和主动式中断。
    - 抢先式中断：GC发生时，把所有的线程都中断，发现有线程不在安全点上就恢复线程让他跑到安全点上。
    - 主动式中断：GC需要中断线程时，设置标识位，各个线程执行时主动去轮询标志，标识位为真时就挂起，轮询标识的地方和安全点重合，外加创建对象需要分配内存的
    地方。
- 安全区域：没有执行的线程是无法中断的。安全区域是指在一段代码中，引用关系不会发生变化，当线程执行到Safe Region中的代码时，就标识进入了Safe Region，当
进行时候，就不用管标识自己进入Safe Region的线程。