# 大型网站架构
## 架构模式

- 分层：横向分层
- 分割：竖向
- 分布式
    - 分层分割的分布式
    - 静态资源分布式
    - 数据分布式
- 集群
- 缓存
    - CDN
    - 反向代理
    - 本地缓存
    - 分布式缓存
- 异步
    - 提高系统可用性
    - 加快网站响应速度
    - 消除并发访问高峰
- 冗余：备份
- 自动化：
    - 发布自动化
    - 自动化代码管理
    - 自动化测试
    - 自动化安全检测
    - 自动化部署
    - 自动化监控
    - 自动化告警
    - 自动化失效转移和恢复
    - 自动化降级
    - 自动化分配资源
- 安全


#### 性能
- 浏览器：浏览器缓存、使用页面压缩、合理的布局页面、减少Cookie传输
- CDN
- 应用服务器：缓存、异步
#### 可用性
#### 伸缩性
是否可以用多台服务器搭建集群、是否容易向集群中添加新的服务器、加入新的服务器后是否可以提供无差别服务，集群中可容纳总服务器数量是否有限制
关系型数据库索然支持数据复制、主从热备等机制，但是很难做到大规模集群的伸缩性，因此关系型数据库的集群伸缩性方案必须在数据库之外，通过路由分区等
手段将部署有多个数据库的服务器组成一个集群。大部分NoSql数据库产品对伸缩性支持都很好。
#### 扩展性
在网站增加新的业务时候，是否可以实现对现有产品透明无影响。时间驱动想架构和分布式服务。


## 总结
#### 系统划分
横向和纵向。横向功能（分布式），纵向代码。
#### 各系统接口
服务化还是消息服务。服务化：限流、容错、降级、禁用。消息服务：堆积、重复、堆积
#### 数据库
主从(读写分)，双主(支持热切)，分库分表（横向分表或纵向分表），横向分库(分布式库)，纵向分表(数据库集群)  

- 纵向切分：纵向分库：根据业务耦合性，将关联度低的不同表存储在不同的数据库；纵向分表：将大表拆分为小表  
- 水平切分：水平切分分为库内分表和分库分表，是将同一个表按不同的条件分散到多个数据库和多表中。
#### 高可用
限流、降级、超时和重试、集群(接入nginx集群的高可用，应用服务器集群高可用)、主从（备份，灾备）  

- 降级：超时，失败次数过多，故障，超流量，人工配置，读降级（读不是最新的数据）

#### 高并发
缓存、队列、扩容

- 缓存: 各级缓存(http,CDN,负载均衡层,应用层)数据一致性，缓存崩溃，（击穿，穿透，雪崩）
- 队列：缓冲/削峰，异步

##### 缓存和数据库数据一致性
Cache aside,Read through/Write through/Write behind caching  

- Cache aside ：A线程从库读，B线程写库，使缓存失效，A回写缓存，导致缓存和数据库长时间不一致，概率小
    - 失效：先从cache取数据，如果没有，则用数据库中取数据，成功后，放到缓存中
    - 命中：从cache中取数据，返回
    - 把数据存到数据库中，成功后，让缓存失效  
- Read through/Write through: 由缓存进行数据库的读取和更改
- Write behind caching: cache page类似，在内存操作，可以定时更新到数据库。开辟内存时，判断页是否为脏，脏的写入数据库。

#### 压测及参数设置（数据库连接池、tomcat连接数、线程池线程数）
